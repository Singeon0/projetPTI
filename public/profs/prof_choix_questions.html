<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Création de questionnaire</title>
  <link rel="stylesheet" href="style_prof.css">
  <script>
    let idProf;
    let questionnaireNameValue;
    function parseIdProf() {
      const urlParams = new URLSearchParams(window.location.search);
      idProf = urlParams.get("idProf");
    }

    function openPage(typeQuestion) {
      questionnaireNameValue = document.getElementById("questionnaireName").value;
      if (typeQuestion == 'relier') {
        window.location.href = "../templates_questions/relier/create_question.html?questionnaireName=" + questionnaireNameValue;
      }
      else if (typeQuestion == "hacher") {
        console.log('hiaaaaa')
        window.location.href = "../templates_questions/hacher/create_question.html?questionnaireName=" + questionnaireNameValue;
      }
    }

    window.onload = function () {
      var questionnaireName = document.getElementById("questionnaireName");
      questionnaireName.addEventListener("input", function () {
        // naviguer vers la page "create_prof.html"

        var bouton = document.getElementById("relier");
        bouton.setAttribute("onclick", "openPage('relier')");

        var bouton2 = document.getElementById("hacher");
        bouton2.setAttribute("onclick", "openPage('hacher')");
      });
    }


    function loadTypesDeQuestions() {
      fetch("/api/types_de_questions")
        .then(response => response.json())
        .then(data => {
          const questionsContainer = document.getElementById("questionsContainer");
          data.forEach(type => {
            const div = document.createElement("div");

            const checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.style.width = "10%";

            const label = document.createElement("label");
            label.textContent = type.type_question;
            label.style.width = "60%";

            const button = document.createElement("button");
            button.textContent = "Personnaliser";
            button.style.width = "30%";
            button.classList.add("button");
            // Ajouter un écouteur d'événement pour le clic sur le bouton
            if (label.textContent === "Relier les bonnes propositions") {
              // Si c'est le cas, ajouter l'attribut id "relier" au bouton
              button.setAttribute("id", "relier");
              button.setAttribute("onclick", "openPage()");
            }

            // Ajouter un écouteur d'événement pour le clic sur le bouton
            if (label.textContent === "Hâchure fractions") {
              // Si c'est le cas, ajouter l'attribut id "relier" au bouton
              button.setAttribute("id", "hacher");
              button.setAttribute("onclick", "openPage()");
            }

            // Ajouter le bouton à la page
            document.body.appendChild(button);

            div.appendChild(checkbox);
            div.appendChild(label);
            div.appendChild(button);
            questionsContainer.appendChild(div);
          });
        });
    }

    document.addEventListener("DOMContentLoaded", () => {
      parseIdProf();
      loadTypesDeQuestions();
    });

    function getSelectedQuestions() {
      const selectedQuestions = [];
      const questionsContainer = document.getElementById("questionsContainer");
      questionsContainer.querySelectorAll("div").forEach((div, index) => {
        const checkbox = div.querySelector("input[type='checkbox']");
        if (checkbox.checked) {
          const label = div.querySelector("label");
          selectedQuestions.push({
            nom: label.textContent,
            numero_question: index
          });
        }
      });
      return selectedQuestions;
    }

    function saveQuestionnaire() {
      const questionnaireName = document.getElementById("questionnaireName").value;
      const selectedQuestions = getSelectedQuestions();
      fetch("/api/save_questionnaire", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          idProf: idProf,
          nom: questionnaireName,
          questions: selectedQuestions
        })
      }).then(response => {
        if (response.ok) {
          alert("Questionnaire sauvegardé avec succès");
        } else {
          alert("Erreur lors de la sauvegarde du questionnaire");
        }
      });
    }


  </script>
</head>

<body>
  <h1>Création de questionnaire</h1>
  <input type="text" id="questionnaireName" placeholder="Nom du questionnaire" style="width: 100%; text-align: center; font-size: 20px; padding: 20px 10px; margin-bottom: 50px;">  <div id="questionsContainer"></div>
  <button class="save-button" onclick="saveQuestionnaire()">Sauvegarder le questionnaire</button>
</body>

</html>